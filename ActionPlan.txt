Βασικοί ρόλοι (στα πλαίσια των UNIX):
    Ansible (???κεντρικά, ανα domain, ανά unix flavor)
    Debian/Ubuntu
    Redhat
    Alpine (docker/kubernetes containers)
    Linux other
    BSD
    Apache
    Nginx
    Postfix
    Squid ???
    ModSecurity ???

Reconnaisance (προασκησιακή φάση):
    O/S name/version
    uname
    IP settings
    interfaces/gateways
    default NS (using dig)
    users/groups/sudoers
    active units
    listening ports
    SUID/GUID αρχεία
    Ταυτοποίηση χρηστών σε services/remote access
    Έλεγχος δικαιωμάτων σε φακέλους χρηστών (ιδίως στο .ssh)
    Έλεγχος δικαιωμάτων σε δημόσιους φακέλους (λχ /var/www/html) 
    Έλεγχος δικαιωμάτων/ομάδων χρηστών (ιδίως sudoers)
    Έλεγχος ssh access/keys
    Έλεγχος chron/processes
    ΕΛΕΓΧΟΣ ANSIBLE PLAYBOOKS
    Εκτέλεση Ansible Playbook, το οποίο θα αποθηκεύει τα δεδομένα σε αρχεία της μορφής hostname(IP?) και θα τα κάνει copy σε δικό μας μηχάνημα,
    ώστε να είναι διαθέσιμα μετά το πέρας της FAMEX.
    Εκτέλεση βασικών εργαλείων ασφαλείας, λχ Lynis, Chkrootkit, Rkhunter, ClamAV με output σε αρχείο και μεταφορά τους σε δικό μας μηχάνημα για περαιτέρω ανάλυση.
    
1η φάση 0'-5' (αρχικό hardening)
   Αλλαγή passwords με δύσκολο (playbook)
   Προσθήκη στους sudoers προεπιλεγμένου χρήστη  (playbook)
   Αφαίρεση υπόλοιποι users/groups από sudoers (playbook)
   Απενεργοποίηση root, περίεργων(SID/GID=0, home=/root), ανεπιθύμητων, διασφάλιση απαίτησης password  (playbook)   

2η φάση 5'-15' (βασικό hardening)
    Ενεργοποίηση AppArmor/SElinux  (playbook)
    sysctl kernel hardening (playbook) πχ:
        net.ipv4.conf.all.rp_filter = 1
        net.ipv4.conf.all.accept_source_route = 0
        net.ipv4.tcp_syncookies = 1
        net.ipv4.icmp_echo_ignore_broadcasts = 1
        net.ipv4.icmp_ignore_bogus_error_messages = 1
        net.ipv4.conf.all.log_martians = 1
        net.ipv4.icmp_ratelimit = 20
        net.ipv4.icmp_ratemask = 88089
        net.ipv4.conf.all.secure_redirects = 1
        net.ipv4.conf.all.shared_media = 1
    Ενεργοποίηση hard limits χρηστών (playbook)
    Νέοι λογαριασμοί shell=/bin/false  (playbook)
    Εφαρμογή password policy  (playbook)
    Ενεργοποίηση iptables/pf  (playbook/manual?)
    Απενεργοποίηση ανεπιθύμητων υπηρεσιών (playbook/manual)
    Απενεργοποίηση ανεπιθύμητων kernel modules (playbook)
    Διαγραφή ανεπιθύμητων χρηστών (playbook)
    Διόρθωση δικαιωμάτων σε φακέλους χρηστών (ιδίως στο .ssh)
    Διόρθωση δικαιωμάτων σε δημόσιους φακέλους (λχ /var/www/html). Εκτός από chmod να εκτελεστεί και chown οπου είναι εφικτό.
    Αποστολή syslog (playbook)
    Ασφάλιση mounts (playbook/script)
    Απενεργοποίηση ALT-CTRL-DEL (playbook)    
    Ενημέρωση (update/upgrade) - Σημείωση (οχι dist-upgrade)/θα πρέπει να χρονομετρηθεί και να γίνει στην 4η φάση εάν η ενημέρωση υπερβαίνει τα 10'
    Επανεκκίνηση (Βαλσαμίδης: Μεταφορά από τη 1η φάση,ώστε να εξοικονομηθεί χρόνος. Εκτιμάται ότι η επανεκκίνηση απαιτείται λόγω kernel updates

3η φάση 15'-30' (ενίσχυση hardening)    
    Εγκατάσταση fail2ban (playbook)
    Εγκατάσταση rkhunter (playbook)
    Εγκατάσταση clamav (playbook)
    Εγκατάσταση aide (playbook)
    Εγκατάσταση ενημερώσεων (playbook)
    Εκτέλεση playbook (ανά VM/συνολικά?) με συγκεκριμένες τρωτότητες που έχουν ανιχνευτεί     
    Σκανάρισμα (playbook)-> Σημείωση(Βαλσαμίδης): νομίζω ότι ο χρόνος θα πρέπει να αφιερωθεί στο να διορθωθούν ευπάθειες που έχουν εντοπιστεί
    (βλέπε προηγούμενο βήμα), καθόσον δεν θα υπάρχει χρόνος εντός 15. 
    Εγκατάσταση sysmon ή scripts για ανίχνευση: (playbook)
        Νέες συνδέσεις
        Έναρξη/τερματισμός υπηρεσιών
        Έναρξη/τερματισμός processes
        Δημιουργία/διαγραφή/τροποποίηση(?τουλάχιστον .conf, crontab) αρχείων
        Raw access read
   Επανεκκίνηση (εάν απαιτείται)
    
4η φάση 30'-60' (τελικό hardening)
    Script clamscan νέων αρχείων σε home (playbook/manual)
    Εγκατάσταση sysmon ή aide/scripts για ανίχνευση (manual όπου δεν έγινε αυτόματα)
    HTTP redirect σε HTTPS (manual) - Σημείωση (Βαλσαμίδης), έλεγχος εάν είναι δεκτά self-signed κλειδιά και η αλλαγή πρωτοκόλλου
    Αυτόματο μπλοκάρισμα IP μέσω TCP wrappers (playbook εφόσον υπάρξει λίστα)
    Εγκατάσταση πιστοποίητικών MITM σε Λ/Σ, Firefox, Chrome (playbook/manual)
    Εγκατάσταση SQUID transparent MITM σε DMZ (manual)
    Εγκατάσταση ModSecurity MITM σε DMZ (manual)
    Εγκατάσταση Mail Security Gateway (από E5)
        
5η φάση (monitoring)
    Συνεχής παρακολούθηση logs (νέες συνδέσεις, αλλαγές configuration)
    Πρώτα βαράμε και μετά ρωτάμε (killall -9 -u offender)
    Αναφορά σε ομαδάρχη, και συντονιστή UNIX
    
Χρήσιμα resources/checklists
https://github.com/trimstray/linux-hardening-checklist
https://www.pluralsight.com/blog/it-ops/linux-hardening-secure-server-checklist
https://security.utexas.edu/os-hardening-checklist/linux-7

